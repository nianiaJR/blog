Title: 几种基本跨域访问方法
Date: 2015-08-05
Category: JavaScript
Tags: 2015, summary
Slug: basic-cors

### 前言
日常开发中偶尔会遇见一些跨域访问资源的问题，最近又重看了《JS高级程序设计》关于这部分的章节，把比较基础的方法拿出来总结。

### 跨域访问
按我的理解，就是当前web应用所在域，向不在同一域的服务器发出请求，即会造成跨域访问。是不是在同一域是由**" 域名＋端口号 "**共同决定的，只要有一点不同即会造成跨域访问。


### 解决办法
1. 使用XMLHttpRequest对象
这个是现在高版本浏览
这个是现在高版本浏览器都支持的原生的XHR对象，具体跨域访问如下：
```
/* 客户端代码 */
var xhr = new XMLHttpRequest();
xhr.open('get', 'example_url', true);
/* 在客户端的请求头部补充一个字段用于告知服务端自己的资源域 */
xhr.setRequestHeader('Origin', 'http:origin.com')
xhr.send(null);
/* 服务器端 */
/* 在相应的api文件部分添加如下字段 */
Access-Control-Allow-Origin: 'http:origin.com';
```
一定要注意设置的源头前后端要一致，这样便可以进行跨域访问了。这种跨域访问的缺点就是服务器端与客户端两边都要同时修改代码才能进行，不过能有很好的控制权。

2. 使用图像ping技术
在写页面的时候，应该知道`<img src="">`可以加载任意域的图像资源，这就相当于跨域，所以可以在src的url后面加query_string(e.g `src='xxx.com?query_string=xxx`)，这样当请求传到服务器端就能读取query-string的参数值，即是完成了跨域访问。此种办法的缺点就是，请求是单向的，并且不能处理请求的返回。

3. JSONP (json with padding)
从后端将数据包裹作为函数的参数，与函数一起返回，而在客户端这边设置一个同名的回调函数，一旦用`<script>`标签访问资源成功后，就会启动这个回调函数，即完成了跨域访问，这种访问是双向的，在双方都相互信任的情况下，这种方式不存在任何问题，不过由于方法特殊，会失去对请求的控制。更详细的讲解可以参考书上的内容，或者这篇帖子也能说明白：[js/ajax跨越访问—jsonp的原理和实例](http://www.cnblogs.com/xuejie/archive/2012/12/25/2832595.html)

4. 其他方式
高教上还说了不少跨域访问的方法，由于我实习开发的时候还没具体遇见，这里仅仅列出自己见到的比较常见的，其他方式可以参考书中内容，还是很详细的^_^。
